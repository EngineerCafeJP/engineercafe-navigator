# 統合ガイド - 統合エージェント担当者向け

## 対象者

- **統合エージェント担当者**: 寺田@terisuke, YukitoLyn
- **役割**: 全体の統合、コンフリクト解決、バランス調整

## 統合エージェント担当者の責任

### 1. 全体の統合管理

- 各エージェントのfeatureブランチをdevelopブランチに統合
- 統合テストの実行と問題の特定
- 全体のアーキテクチャの一貫性を保つ

### 2. コンフリクト解決

- featureブランチのマージ時のコンフリクト解決
- 複数エージェントが同じファイルを変更した場合の調整
- アーキテクチャレベルの決定

### 3. バランス調整

- 各エージェントの開発進捗を把握
- 優先順位の調整
- リソース配分の最適化

### 4. コードレビュー

- 各エージェントのPRレビュー
- コード品質の確認
- テストカバレッジの確認

## 開発フローでの役割

### Phase 1: featureブランチのマージ前

**チェックリスト**:

- [ ] エージェントの実装が完了している
- [ ] 単体テストが通過している
- [ ] ドキュメントが更新されている
- [ ] コードレビューが完了している
- [ ] developブランチとのコンフリクトがない（または解決済み）

### Phase 2: developブランチでの統合

**手順**:

1. **featureブランチをdevelopにマージ**
   ```bash
   git checkout develop
   git pull origin develop
   git merge feature/{agent-name}
   ```

2. **コンフリクトの確認**
   ```bash
   git status
   # コンフリクトがあれば解決
   ```

3. **統合テストの実行**
   ```bash
   # バックエンドのテスト
   cd backend
   pytest tests/
   
   # 統合テスト
   pytest tests/integration/
   ```

4. **問題の特定と修正依頼**
   - 問題があれば、該当エージェント担当者に修正依頼
   - 問題がなければ、次のエージェントの統合に進む

### Phase 3: mainブランチへのマージ準備

**条件**:

- [ ] すべてのエージェントがdevelopブランチに統合済み
- [ ] 統合テストがすべて通過
- [ ] パフォーマンステストが通過
- [ ] ドキュメントが完全
- [ ] コードレビューが完了

**手順**:

1. **developブランチの最終確認**
   ```bash
   git checkout develop
   git pull origin develop
   # 最終的な統合テストを実行
   ```

2. **mainブランチへのPR作成**
   - base: `main`
   - compare: `develop`
   - レビュアー: 統合エージェント担当者

3. **承認後のマージ**
   - 承認後、mainブランチにマージ
   - タグ付け（`v1.0.0`等）

## コンフリクト解決ガイド

### コンフリクトの種類

#### 1. ファイルレベルのコンフリクト

**発生例**:
- 複数のエージェントが同じファイルを変更
- `backend/workflows/main_workflow.py`の変更が重複

**解決方法**:
1. コンフリクトファイルを確認
2. 各エージェントの変更内容を理解
3. 両方の変更を統合（可能な場合）
4. 統合できない場合は、該当エージェント担当者と協議

#### 2. アーキテクチャレベルのコンフリクト

**発生例**:
- State定義の変更が重複
- ツールのインターフェースが異なる

**解決方法**:
1. 統合エージェント担当者が設計を決定
2. 該当エージェント担当者に修正依頼
3. 統一されたアーキテクチャに合わせて実装

#### 3. 依存関係のコンフリクト

**発生例**:
- 異なるバージョンのライブラリを使用
- データベーススキーマの変更が重複

**解決方法**:
1. 依存関係を統一
2. データベースマイグレーションを統合
3. バージョン管理を明確化

### コンフリクト解決の手順

1. **コンフリクトの確認**
   ```bash
   git merge feature/{agent-name}
   # コンフリクトが発生
   git status
   ```

2. **コンフリクトファイルの編集**
   - コンフリクトマーカー（`<<<<<<<`, `=======`, `>>>>>>>`）を確認
   - 各変更内容を理解
   - 適切に統合

3. **解決後の確認**
   ```bash
   git add {conflicted-files}
   git commit -m "resolve: merge conflict in {file}"
   ```

4. **テストの実行**
   ```bash
   pytest tests/
   ```

## 統合テストの実行

### テストの種類

#### 1. 単体テスト

各エージェントの単体テスト:
```bash
cd backend
pytest tests/agents/test_router_agent.py
pytest tests/agents/test_business_info_agent.py
# ...
```

#### 2. 統合テスト

エージェント間の統合テスト:
```bash
pytest tests/integration/test_workflow_integration.py
```

#### 3. エンドツーエンドテスト

全体のワークフローテスト:
```bash
pytest tests/e2e/test_full_workflow.py
```

### テスト実行のタイミング

- **featureブランチマージ前**: 該当エージェントの単体テスト
- **developブランチ統合後**: 統合テスト
- **mainブランチマージ前**: エンドツーエンドテスト

## パフォーマンス監視

### 監視項目

1. **レスポンスタイム**
   - 各エージェントの処理時間
   - ワークフロー全体の処理時間

2. **リソース使用量**
   - メモリ使用量
   - CPU使用率
   - データベース接続数

3. **エラー率**
   - 各エージェントのエラー率
   - ワークフロー全体のエラー率

### 監視ツール

- **LangSmith**: LangGraphのデバッグとモニタリング
- **ログ**: 構造化ログによる分析
- **メトリクス**: Prometheus等のメトリクス収集

## コミュニケーション

### 定期的なミーティング

- **週次進捗確認**: 各エージェントの進捗を確認
- **統合レビュー**: developブランチの統合状況を確認
- **問題解決**: コンフリクトや問題の解決

### コミュニケーションチャネル

- **GitHub Issues**: 問題の報告と追跡
- **Pull Requests**: コードレビューと議論
- **Slack/Discord**: 日常的なコミュニケーション

## チェックリスト

### featureブランチマージ前

- [ ] エージェントの実装が完了
- [ ] 単体テストが通過
- [ ] ドキュメントが更新
- [ ] コードレビューが完了
- [ ] developブランチとのコンフリクトがない

### developブランチ統合後

- [ ] 統合テストが通過
- [ ] パフォーマンステストが通過
- [ ] エラーログに問題がない
- [ ] ドキュメントが最新

### mainブランチマージ前

- [ ] すべてのエージェントが統合済み
- [ ] すべてのテストが通過
- [ ] パフォーマンスが基準を満たしている
- [ ] ドキュメントが完全
- [ ] コードレビューが完了

## トラブルシューティング

### よくある問題

#### 1. 統合テストが失敗する

**原因**:
- エージェント間のインターフェースが一致していない
- データベーススキーマが不一致

**解決方法**:
- インターフェースを統一
- データベースマイグレーションを確認

#### 2. パフォーマンスが低下

**原因**:
- 非効率なクエリ
- リソースの競合

**解決方法**:
- クエリの最適化
- リソースの調整

#### 3. コンフリクトが頻発

**原因**:
- 複数のエージェントが同じファイルを変更
- アーキテクチャの設計が不明確

**解決方法**:
- ファイルの責任範囲を明確化
- アーキテクチャの設計を統一

## 参考資料

- [BRANCH-STRATEGY.md](./BRANCH-STRATEGY.md): ブランチ戦略の詳細
- [COWORKING-SYSTEM-ANALYSIS.md](./COWORKING-SYSTEM-ANALYSIS.md): 参考実装の分析
- [TEAM-ASSIGNMENTS.md](./TEAM-ASSIGNMENTS.md): チーム担当者一覧

